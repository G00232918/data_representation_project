<!-- players.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Players</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>
    <!-- Player Section -->
    <h1>PLAYERS</h1>
    <div> <button id="showCreatePlayerButton" class="btn btn-success">Create Player</button></div>
    <div>
        <!-- Table to display player data -->
        <table class="table table-striped table-dark table-bordered table-hover" id="playerTable">
            <thead>
                <!-- Table headers -->
                <tr>
                    <th scope="col">id</th>
                    <th scope="col">Full Name</th>
                    <th scope="col">Age</th>
                    <th scope="col">Nationality</th>
                    <th scope="col">Update</th>
                    <th scope="col">Delete</th>
                </tr>
            </thead>
            <tbody>
                <!-- Player Table rows will be added here dynamically -->
            </tbody>
        </table>
    </div>
    <!-- Form to create/update player -->
    <div id='createUpdatePlayerForm' style="display: none">
        <h2><span id="createPlayerLabel">Create a</span><span id="updatePlayerLabel" style="display: none;">Update</span> Player</h2>
        <input type="hidden" id="playerId"/>
        Full Name <input type="text" id="playerFullName" /><br/>
        Age <input type="number" id="playerAge"/> <br/>
        Nationality <input type="text" id="playerNationality"/> <br/>
        <!-- Buttons to perform create and update operations -->
        <button id="doCreatePlayerButton" class="btn btn-primary">Create Player</button>
        <button id="doUpdatePlayerButton" class="btn btn-warning" style="display: none;">Update Player</button>
    </div>


    <!-- Players JavaScript -->
    <!-- https://towardsdatascience.com/using-python-flask-and-ajax-to-pass-
        information-between-the-client-and-server-90670c64d688-->
    <script>
        $(document).ready(function(){
            // click for Create Player button
            $("#showCreatePlayerButton").on("click", function() {
                showCreatePlayer();
            });
            // Click to Create Player from form
            $("#doCreatePlayerButton").on("click", function() {
                doCreatePlayer();
            });
            // Click to update player
            $("#doUpdatePlayerButton").on("click", function() {
                doUpdatePlayer();
            });
            // 
            $(document).on("click", ".updatePlayerButton", function(){
                var playerId = $(this).closest("tr").data("id");
                showUpdatePlayer(playerId);
            });
            // click to delete player
            $(document).on("click", ".deletePlayerButton", function(){
                var playerId = $(this).closest("tr").data("id");
                doDeletePlayer(playerId);
            });
            // fetch all players from the table when page loads
            getAllPlayers();

            // fucntino to show create form
            function showCreatePlayer() {
                clearPlayerForm();
                $("#createUpdatePlayerForm").show();
                $("#createPlayerLabel").show();
                $("#updatePlayerLabel").hide();
                $("#doCreatePlayerButton").show();
                $("#doUpdatePlayerButton").hide();
            }
            // clear form function
            function clearPlayerForm() {
                $("#playerId").val('');
                $("#playerFullName").val('');
                $("#playerAge").val('');
                $("#playerNationality").val('');
            }
            // functoion to show the player udate form with existing data
            function showUpdatePlayer(playerId) {
                // ajax request to fetch player data by id
                $.get("http://127.0.0.1:5000/players/" + playerId, function(player) {
                    $("#playerId").val(player.id);
                    $("#playerFullName").val(player.Full_Name);
                    $("#playerAge").val(player.Age);
                    $("#playerNationality").val(player.Nationality);
                    $("#createUpdatePlayerForm").show();
                    $("#createPlayerLabel").hide();
                    $("#updatePlayerLabel").show();
                    $("#doCreatePlayerButton").hide();
                    $("#doUpdatePlayerButton").show();
                });
            }
            // function to create new player
            function doCreatePlayer() {
                var player = {
                    Full_Name: $("#playerFullName").val(),
                    Age: $("#playerAge").val(),
                    Nationality: $("#playerNationality").val()
                };
                // ajax request to create a new player
                $.ajax({
                    url: "http://127.0.0.1:5000/players",
                    method: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(player),
                    success: function(newPlayer) {
                        addPlayerToTable(newPlayer);
                        clearPlayerForm();
                        $("#createUpdatePlayerForm").hide();
                    }
                });
            }
            // function to update existing player
            function doUpdatePlayer() {
                var player = {
                    id: $("#playerId").val(),
                    Full_Name: $("#playerFullName").val(),
                    Age: $("#playerAge").val(),
                    Nationality: $("#playerNationality").val()
                };
                // ajax request to update player
                $.ajax({
                    url: "http://127.0.0.1:5000/players/" + player.id,
                    method: "PUT",
                    contentType: "application/json",
                    data: JSON.stringify(player),
                    success: function(updatedPlayer) {
                        updatePlayerInTable(updatedPlayer);
                        clearPlayerForm();
                        $("#createUpdatePlayerForm").hide();
                    }
                });
            }
            // function to delete player
            function doDeletePlayer(playerId) {
                $.ajax({
                    url: "http://127.0.0.1:5000/players/" + playerId,
                    method: "DELETE",
                    success: function() {
                        removePlayerFromTable(playerId);
                    }
                });
            }
            // function to get all the players
            function getAllPlayers() {
                $.get("http://127.0.0.1:5000/players", function(players) {
                    players.forEach(function(player) {
                        addPlayerToTable(player);
                    });
                });
            }
            // function to add the player to table
            function addPlayerToTable(player) {
                var row = $('<tr>').data("id", player.id);
                row.append($('<td>').text(player.id));
                row.append($('<td>').text(player.Full_Name));
                // https://stackoverflow.com/questions/41138210/how-to-append-table-row-with-specific-number-in-jquery
                row.append($('<td>').text(parseInt(player.Age)));
                row.append($('<td>').text(player.Nationality));
                row.append($('<td>').html('<button class="updatePlayerButton btn btn-primary">Update</button>'));
                row.append($('<td>').html('<button class="deletePlayerButton btn btn-danger">Delete</button>'));
                $("#playerTable tbody").append(row);
            }
            // functin to update the player in table
            function updatePlayerInTable(player) {
                var row = $("#playerTable tbody").find('tr').filter(function() {
                    return $(this).data("id") == player.id;
                });
                // each row to be updated
                row.find('td:eq(1)').text(player.Full_Name);
                row.append($('<td>').text(parseInt(player.Age)));
                row.find('td:eq(3)').text(player.Nationality);
            }
            // function to remove a player from the table
            function removePlayerFromTable(playerId) {
                $("#playerTable tbody").find('tr').filter(function() {
                    return $(this).data("id") == playerId;
                }).remove();
            }
        });
    </script>
</body>
</html>
