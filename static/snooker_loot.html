<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Players and Player Stats</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>
    <!-- Player Section -->
    <h1>Snooker Player Data</h1>
    <div> <button id="showCreatePlayerButton" class="btn btn-primary" onclick="showCreate()">Create Player</button></div>
    <div>
        <table class="table table-striped table-info table-bordered" id="playerTable">
            <thead>
                <tr>
                    <th scope="col">id</th>
                    <th scope="col">Full_Name</th>
                    <th scope="col">Age</th>
                    <th scope="col">Nationality</th>
                    <th scope="col">Update</th>
                    <th scope="col">Delete</th>
                </tr>
            </thead>
            <tbody>
                <!-- Player Table rows will be added here -->
            </tbody>
        </table>
    </div>
    <div id='createUpdatePlayerForm' style="display: none">
        <h2><span id="createPlayerLabel">Create a Player</span><span id="updatePlayerLabel" style="display: none;">Update</span> Player</h2>
        <input type="hidden" id="playerId"/>
        Full_Name <input type="text" id="playerFullName" /><br/>
        Age <input type="number" id="playerAge"/> <br/>
        Nationality <input type="text" id="playerNationality"/> <br/>
        <button id="doCreatePlayerButton" class="btn btn-primary" onclick="doCreate()">Create Player</button>
        <button id="doUpdatePlayerButton" class="btn btn-warning" style="display: none;" onclick="doUpdate()">Update Player</button>

    </div>

    <!-- Player Stats Section -->
    <h1>Prize Money Total Table</h1>
    <div>
        <table class="table table-striped table-info table-bordered" id="playerStatTable">
            <thead>
                <tr>
                    <th scope="col">id</th>
                    <th scope="col">Full_Name</th>
                    <th scope="col">Total_Prize_Money</th>
                </tr>
            </thead>
            <tbody>
                <!-- PlayerStat Table rows will be added here -->
            </tbody>
        </table>
    </div>

    <!-- Player JavaScript -->
    <script>
        function showCreate() {
            document.getElementById('showCreatePlayerButton').style.display = "none";
            document.getElementById('playerTable').style.display = "none";
            document.getElementById('createUpdatePlayerForm').style.display = "block";

            document.getElementById('createPlayerLabel').style.display = "inline";
            document.getElementById('updatePlayerLabel').style.display = "none";

            document.getElementById('doCreatePlayerButton').style.display = "block";
            document.getElementById('doUpdatePlayerButton').style.display = "none";
        }

        function showViewAll() {
            document.getElementById('showCreatePlayerButton').style.display = "block";
            document.getElementById('playerTable').style.display = "block";
            document.getElementById('createUpdatePlayerForm').style.display = "none";
        }

        function showUpdate(buttonElement) {
            document.getElementById('showCreatePlayerButton').style.display = "none";
            document.getElementById('playerTable').style.display = "none";
            document.getElementById('createUpdatePlayerForm').style.display = "block";

            document.getElementById('createPlayerLabel').style.display = "none";
            document.getElementById('updatePlayerLabel').style.display = "inline";

            document.getElementById('doCreatePlayerButton').style.display = "none";
            document.getElementById('doUpdatePlayerButton').style.display = "block";

            var rowElement = buttonElement.parentNode.parentNode;
            var player = getPlayerFromRow(rowElement);
            populateFormWithPlayer(player);
        }

        function doCreate() {
            var form = document.getElementById('createUpdatePlayerForm');
            var player = {};
            player.Full_Name = form.querySelector('input[id="playerFullName"]').value;
            player.Age = parseInt(form.querySelector('input[id="playerAge"]').value); // Convert to integer
            player.Nationality = form.querySelector('input[id="playerNationality"]').value;
            createPlayerAjax(player);
        }

        function doUpdate() {
            var player = getPlayerFromForm();
            var rowElement = document.getElementById(player.id);
            updatePlayerAjax(player);
            setPlayerInRow(rowElement, player);
            clearForm();
            showViewAll();
        }

        function doDelete(r) {
            var tableElement = document.getElementById('playerTable');
            var rowElement = r.parentNode.parentNode;
            var index = rowElement.rowIndex;
            deletePlayerAjax(rowElement.getAttribute("id"));
            tableElement.deleteRow(index);
        }
        function showViewAllPlayerStat() {
            document.getElementById('playerStatTable').style.display = "block";
        }

        function addPlayerToTable(playerData) {
            var tableElement = document.getElementById('playerTable');
            var rowElement = tableElement.insertRow(-1);
            rowElement.setAttribute('id', playerData[0]);
            for (var i = 0; i < playerData.length; i++) {
                var cell = rowElement.insertCell(i);
                cell.innerHTML = playerData[i];
            }
            var updateCell = rowElement.insertCell(playerData.length);
            updateCell.innerHTML = '<button onclick="showUpdate(this)">Update</button>';
            var deleteCell = rowElement.insertCell(playerData.length + 1);
            deleteCell.innerHTML = '<button onclick="doDelete(this)">Delete</button>';
        }

        function clearForm() {
            var form = document.getElementById('createUpdatePlayerForm');
            form.querySelector('input[id="playerFullName"]').value = '';
            form.querySelector('input[id="playerAge"]').value = '';
            form.querySelector('input[id="playerNationality"]').value = '';
        }

        function getPlayerFromRow(rowElement) {
            var player = {};
            player.id = rowElement.getAttribute('id');
            player.Full_Name = rowElement.cells[1].innerHTML;
            player.Age = rowElement.cells[2].innerHTML;
            player.Nationality = rowElement.cells[3].innerHTML;
            return player;
        }

        function setPlayerInRow(rowElement, player) {
            rowElement.cells[0].innerHTML = player.id;
            rowElement.cells[1].innerHTML = player.Full_Name;
            rowElement.cells[2].innerHTML = player.Age;
            rowElement.cells[3].innerHTML = player.Nationality;
        }

        function populateFormWithPlayer(player) {
            var form = document.getElementById('createUpdatePlayerForm');
            form.querySelector('input[id="playerId"]').disabled = true;
            form.querySelector('input[id="playerId"]').value = player.id;
            form.querySelector('input[id="playerFullName"]').value = player.Full_Name;
            form.querySelector('input[id="playerAge"]').value = player.Age;
            form.querySelector('input[id="playerNationality"]').value = player.Nationality;
        }

        function getPlayerFromForm() {
            var form = document.getElementById('createUpdatePlayerForm');
            var player = {};
            player.id = form.querySelector('input[id="playerId"]').value;
            player.Full_Name = form.querySelector('input[id="playerFullName"]').value;
            player.Age = parseInt(form.querySelector('input[id="playerAge"]').value); 
            player.Nationality = form.querySelector('input[id="playerNationality"]').value;
            return player;
        }

    
        function addPlayerStatsToTable(playerstatsData) {
            var tableElement = document.getElementById('playerStatTable');
            var rowElement = tableElement.insertRow(-1);
            var cell = rowElement.insertCell(0);
            cell.innerHTML = playerstatsData.ID;
            var cell2 = rowElement.insertCell(1);
            cell2.innerHTML = playerstatsData.Full_Name;
            var cell3 = rowElement.insertCell(2);
            cell3.innerHTML = playerstatsData.Total_Prize_Money;
        }


        function getPlayerStatsFromRow(rowElement) {
            var playerstats = {};
            playerstats.ID = rowElement.cells[0].innerHTML;
            playerstats.Full_Name = rowElement.cells[1].innerHTML;
            playerstats.Total_Prize_Money = rowElement.cells[2].innerHTML;
            return playerstats;
        }

        function setPlayerStatsInRow(rowElement, playerstats) {
            rowElement.cells[0].innerHTML = playerstats.ID;
            rowElement.cells[1].innerHTML = playerstats.Full_Name;
            rowElement.cells[2].innerHTML = playerstats.Total_Prize_Money;
        }

        function getAllAjax() {
            $.ajax({
                url: "http://127.0.0.1:5000/players",
                method: "GET",
                dataType: "JSON",
                success: function(result) {
                    console.log("Success:", result);
                    result.forEach(function(players) {
                        addPlayerToTable(players);
                    });
                },
                error: function(xhr, status, error) {
                    console.log("Error:", status, "Message:", error);
                }
            });
        }

        function createPlayerAjax(player) {
            console.log(JSON.stringify(player));
            $.ajax({
                url: "http://127.0.0.1:5000/players",
                method: "POST",
                data: JSON.stringify(player),
                dataType: "JSON",
                contentType: "application/json; charset=utf-8",
                success: function(result) {
                    player.id = result.id;
                    addPlayerToTable(player);
                    clearForm();
                    showViewAll();
                },
                error: function(xhr, status, error) {
                    console.log("Error:", status, "Message:", error);
                }
            });
        }

        function updatePlayerAjax(player) {
            console.log("Player Data:", player);
            $.ajax({
                url: "http://127.0.0.1:5000/players/" + encodeURI(player.id),
                method: "PUT",
                data: JSON.stringify(player),
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function(result) {
                    console.log("Success:", result);
                },
                error: function(xhr, status, error) {
                    console.log("Error:", status, "Message:", error);
                }
            });
        }

        function deletePlayerAjax(id) {
            $.ajax({
                "url": "http://127.0.0.1:5000/players/" + encodeURI(id),
                "method": "DELETE",
                "data": "",
                "dataType": "JSON",
                contentType: "application/json; charset=utf-8",
                "success": function(result) {
                    // console.log(result);
                },
                "error": function(xhr, status, error) {
                    console.log("Error:", status, "Message:", error);
                }
            });
        }

        function getAllPlayerStatsAjax() {
            $.ajax({
                url: "http://127.0.0.1:5000/playerstats",
                method: "GET",
                dataType: "JSON",
                success: function(result) {
                    console.log("Success:", result);
                    result.forEach(function(playerstats) {
                        addPlayerStatsToTable(playerstats);
                    });
                },
                error: function(xhr, status, error) {
                    console.log("Error:", status, "Message:", error);
                }
            });
        }


        getAllAjax();
        getAllPlayerStatsAjax();

    </script>
</body>

</html>
